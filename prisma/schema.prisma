generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Account {
  id             Int            @id @default(autoincrement())
  fullName       String
  email          String         @unique
  password       String?
  dob            DateTime?
  gender         String?
  status         Int?
  roleId         Int
  isLoginGoogle  Int
  defaultAddress Int?           @unique
  address        Address?       @relation("DefaultAddress", fields: [defaultAddress], references: [id])
  role           Role           @relation(fields: [roleId], references: [id])
  addresses      Address[]      @relation("ListAddresses")
  favourites     Favourite[]
  feedbacks      Feedback[]
  orders         Order[]
  shoppingCarts  ShoppingCart[]
  userBehaviors  UserBehavior[]
  viewHistories  ViewHistory[]
}

model Role {
  id          Int          @id @default(autoincrement())
  name        String?      @unique
  accounts    Account[]
  permissions Permission[]
}

model Permission {
  id     Int    @id @default(autoincrement())
  url    String @unique
  roleId Int
  role   Role   @relation(fields: [roleId], references: [id])
}

model Address {
  id          Int      @id @default(autoincrement())
  name        String
  address     String
  phoneNumber String
  accountId   Int
  status      Int
  defaultFor  Account? @relation("DefaultAddress")
  account     Account  @relation("ListAddresses", fields: [accountId], references: [id])
  orders      Order[]
}

model Categories {
  id                Int               @id @default(autoincrement())
  name              String            @unique
  parentId          Int?
  status            Int
  parent            Categories?       @relation("ParentCategory", fields: [parentId], references: [id])
  children          Categories[]      @relation("ParentCategory")
  products          Product[]
  voucherCategories VoucherCategory[]
}

model Product {
  id                Int                @id @default(autoincrement())
  name              String
  description       String
  categoryId        Int
  status            Int
  saleFigure        Int
  rateStar          Float?
  favourites        Favourite[]
  medias            Media[]
  category          Categories         @relation(fields: [categoryId], references: [id])
  productFeatures   ProductFeature[]
  productPromotions ProductPromotion[]
  productVariants   ProductVariant[]
  userBehaviors     UserBehavior[]
  viewHistories     ViewHistory[]
}

model ProductVariant {
  id            Int            @id @default(autoincrement())
  productId     Int?
  price         Int
  quantity      Int
  size          String
  color         String
  status        Int
  feedbacks     Feedback[]
  orderDetails  OrderDetail[]
  product       Product?       @relation(fields: [productId], references: [id])
  shoppingCarts ShoppingCart[]

  @@unique([productId, size, color], name: "productVariantUnique")
}

model ViewHistory {
  id        Int      @id @default(autoincrement())
  accountId Int?
  productId Int
  viewDate  DateTime
  uuid      String?
  account   Account? @relation(fields: [accountId], references: [id])
  product   Product  @relation(fields: [productId], references: [id])
}

model Favourite {
  id        Int     @id @default(autoincrement())
  accountId Int
  productId Int
  account   Account @relation(fields: [accountId], references: [id])
  product   Product @relation(fields: [productId], references: [id])
}

model Media {
  id         Int       @id @default(autoincrement())
  url        String
  type       Int
  productId  Int?
  feedbackId Int?
  feedback   Feedback? @relation(fields: [feedbackId], references: [id])
  product    Product?  @relation(fields: [productId], references: [id])

  @@unique([productId, url], name: "mediaUnique")
}

model Voucher {
  id                Int               @id @default(autoincrement())
  code              String            @unique
  discountPercent   Int
  startDate         DateTime
  endDate           DateTime
  name              String
  quantity          Int
  condition         Int
  description       String
  type              Int
  status            Int
  orderVouchers     OrderVoucher[]
  voucherCategories VoucherCategory[]
}

model VoucherCategory {
  id                  Int                  @id @default(autoincrement())
  voucherId           Int?
  categoryId          Int?
  category            Categories?          @relation(fields: [categoryId], references: [id])
  voucher             Voucher?             @relation(fields: [voucherId], references: [id])
  voucherOrderDetails VoucherOrderDetail[]
}

model Promotion {
  id                Int                @id @default(autoincrement())
  percent           Int
  startDate         DateTime
  endDate           DateTime
  status            Int
  productPromotions ProductPromotion[]
}

model ProductPromotion {
  id          Int        @id @default(autoincrement())
  productId   Int?
  promotionId Int?
  product     Product?   @relation(fields: [productId], references: [id])
  promotion   Promotion? @relation(fields: [promotionId], references: [id])

  @@unique([productId, promotionId], name: "productPromotionUnique")
}

model ShoppingCart {
  id               Int             @id @default(autoincrement())
  productVariantId Int?
  accountId        Int?
  status           Int
  quantity         Int
  updateAt         DateTime
  account          Account?        @relation(fields: [accountId], references: [id])
  productVariant   ProductVariant? @relation(fields: [productVariantId], references: [id])
}

model Order {
  id                   Int                  @id @default(autoincrement())
  accountId            Int?
  total                Int
  orderDate            DateTime
  currentStatus        Int?
  addressId            Int
  bills                Bill[]
  account              Account?             @relation(fields: [accountId], references: [id])
  address              Address              @relation(fields: [addressId], references: [id])
  orderStatus          OrderStatus?         @relation(fields: [currentStatus], references: [id])
  orderDetails         OrderDetail[]
  orderStatusHistories OrderStatusHistory[]
  orderVouchers        OrderVoucher[]
}

model OrderStatus {
  id                   Int                  @id @default(autoincrement())
  name                 String
  orders               Order[]
  orderStatusHistories OrderStatusHistory[]
}

model OrderStatusHistory {
  id          Int          @id @default(autoincrement())
  orderId     Int?
  statusId    Int?
  date        DateTime
  note        String
  order       Order?       @relation(fields: [orderId], references: [id])
  orderStatus OrderStatus? @relation(fields: [statusId], references: [id])
}

model OrderVoucher {
  id        Int      @id @default(autoincrement())
  orderId   Int?
  voucherId Int?
  order     Order?   @relation(fields: [orderId], references: [id])
  voucher   Voucher? @relation(fields: [voucherId], references: [id])
}

model OrderDetail {
  id                  Int                  @id @default(autoincrement())
  productVariantId    Int?
  orderId             Int?
  quantity            Int
  order               Order?               @relation(fields: [orderId], references: [id])
  productVariant      ProductVariant?      @relation(fields: [productVariantId], references: [id])
  voucherOrderDetails VoucherOrderDetail[]
}

model VoucherOrderDetail {
  id              Int              @id @default(autoincrement())
  voucherId       Int?
  orderDetailId   Int?
  orderDetail     OrderDetail?     @relation(fields: [orderDetailId], references: [id])
  voucherCategory VoucherCategory? @relation(fields: [voucherId], references: [id])
}

model Feedback {
  id               Int             @id @default(autoincrement())
  accountId        Int?
  productVariantId Int?
  content          String
  feeedbackDate    DateTime
  star             Int
  status           Int
  account          Account?        @relation(fields: [accountId], references: [id])
  productVariant   ProductVariant? @relation(fields: [productVariantId], references: [id])
  medias           Media[]
}

model Bill {
  id            Int          @id @default(autoincrement())
  orderId       Int?
  shippingFeeId Int?
  status        Int
  paymentMethod String
  invoiceTime   DateTime
  paymentTime   DateTime
  total         Int
  order         Order?       @relation(fields: [orderId], references: [id])
  shippingFee   ShippingFee? @relation(fields: [shippingFeeId], references: [id])
}

model ShippingFee {
  id          Int    @id @default(autoincrement())
  maxDistance Int
  minDistance Int
  cost        Int
  bills       Bill[]
}

model ProductFeature {
  id          Int      @id @default(autoincrement())
  productId   Int?
  fit         String
  material    String
  occasion    String
  season      String
  color       String
  size        String
  price       String
  style       String
  age         String
  neckline    String
  sleeve      String
  pantLength  String
  pantShape   String
  dressLength String
  dressShape  String
  skirtLength String
  skirtShape  String
  product     Product? @relation(fields: [productId], references: [id])
}

model UserBehavior {
  id           Int      @id @default(autoincrement())
  accountId    Int?
  productId    Int?
  behaviorType Int
  time         DateTime
  uuid         String?
  account      Account? @relation(fields: [accountId], references: [id])
  product      Product? @relation(fields: [productId], references: [id])
}
